<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë§ ê²½ì£¼ ì¶”ì²¨ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #1f2933, #020617 60%);
      color: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .container {
      width: 100%;
      max-width: 960px;
      background: rgba(15, 23, 42, 0.92);
      border-radius: 20px;
      padding: 24px 24px 28px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .title {
      text-align: center;
      margin-bottom: 18px;
    }

    .title h1 {
      font-size: 1.9rem;
      letter-spacing: 0.06em;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .title .accent {
      font-size: 0.9rem;
      color: #38bdf8;
      letter-spacing: 0.16em;
      text-transform: uppercase;
    }

    .title .emoji {
      font-size: 1.2rem;
      margin-left: 4px;
    }

    .control-panel {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1.1fr);
      gap: 18px;
      margin-bottom: 18px;
    }

    @media (max-width: 720px) {
      .control-panel {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field-label {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #namesInput {
      width: 100%;
      min-height: 120px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 10px 12px;
      color: #e5e7eb;
      font-size: 0.9rem;
      resize: vertical;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    #namesInput:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
      background: rgba(15, 23, 42, 0.98);
    }

    .hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 4px;
    }

    .right-panel-inner {
      height: 100%;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(8, 47, 73, 0.7), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(56, 189, 248, 0.35);
      padding: 14px 14px 16px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .right-panel-inner h2 {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .right-panel-inner ul {
      font-size: 0.8rem;
      color: #cbd5f5;
      margin-left: 16px;
      margin-bottom: 10px;
    }

    .right-panel-inner li + li {
      margin-top: 2px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease, opacity 0.15s ease;
      white-space: nowrap;
    }

    button:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    #startBtn {
      background: linear-gradient(135deg, #f97316, #ec4899);
      color: #f9fafb;
      box-shadow: 0 8px 20px rgba(249, 115, 22, 0.45);
      flex: 1;
    }

    #startBtn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(236, 72, 153, 0.55);
    }

    #startBtn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 6px 14px rgba(236, 72, 153, 0.5);
    }

    #resetBtnSmall {
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
      padding-inline: 12px;
    }

    #resetBtnSmall:hover:not(:disabled) {
      transform: translateY(-1px);
    }

    .race-wrapper {
      margin-top: 16px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.15), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(236, 72, 153, 0.16), transparent 55%),
                  rgba(15, 23, 42, 0.95);
      border-radius: 16px;
      padding: 14px 14px 16px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      position: relative;
      overflow: hidden;
    }

    .race-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .race-header-left {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      color: #9ca3af;
    }

    .race-light {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px #22c55e;
    }

    .race-header-right {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .race-area {
      position: relative;
      margin-top: 4px;
      padding: 10px 10px 12px 42px;
      border-radius: 14px;
      background: repeating-linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.7),
        rgba(15, 23, 42, 0.7) 52px,
        rgba(31, 41, 55, 0.9) 52px,
        rgba(31, 41, 55, 0.9) 54px
      );
      overflow: hidden;
      min-height: 80px;
    }

    .finish-line {
      position: absolute;
      top: 0;
      right: 70px;
      width: 14px;
      height: 100%;
      background-image: linear-gradient(
          45deg,
          #e5e7eb 25%,
          transparent 25%,
          transparent 50%,
          #e5e7eb 50%,
          #e5e7eb 75%,
          transparent 75%,
          transparent
        );
      background-size: 12px 12px;
      opacity: 0.8;
    }

    .finish-label {
      position: absolute;
      top: 6px;
      right: 18px;
      transform: rotate(-7deg);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #fbbf24;
    }

    .tracks {
      position: relative;
      z-index: 1;
    }

    .track-row {
      position: relative;
      height: 52px;
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }

    .track-row:last-child {
      margin-bottom: 0;
    }

    .lane-label {
      position: absolute;
      left: -32px;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.8);
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5e7eb;
    }

    .horse {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translate(0, -50%);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(17, 24, 39, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: 0 8px 14px rgba(15, 23, 42, 0.9);
      font-size: 0.82rem;
      white-space: nowrap;
      backdrop-filter: blur(10px);
    }

    .horse-emoji {
      font-size: 1rem;
    }

    .horse-name {
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .winner-track {
      animation: winnerGlow 1.2s ease-in-out infinite alternate;
    }

    @keyframes winnerGlow {
      from {
        box-shadow: inset 0 0 0 0 rgba(252, 211, 77, 0.2);
      }
      to {
        box-shadow: inset 0 0 0 120px rgba(252, 211, 77, 0.13);
      }
    }

    .hidden {
      display: none !important;
    }

    .winner-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.98));
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
      backdrop-filter: blur(4px);
    }

    .winner-card {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-radius: 22px;
      padding: 20px 22px 22px;
      border: 1px solid rgba(249, 115, 22, 0.5);
      max-width: 420px;
      width: 100%;
      text-align: center;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.65);
      position: relative;
      overflow: hidden;
    }

    .winner-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% 0%, rgba(251, 191, 36, 0.15), transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(236, 72, 153, 0.2), transparent 60%);
      opacity: 0.85;
      z-index: -1;
    }

    .winner-icon {
      font-size: 2.1rem;
      margin-bottom: 2px;
    }

    .winner-title {
      font-size: 1.2rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #fde68a;
      margin-bottom: 6px;
    }

    .winner-name {
      font-size: 1.7rem;
      font-weight: 800;
      margin-bottom: 6px;
      color: #f9fafb;
    }

    .winner-sub {
      font-size: 0.9rem;
      color: #e5e7eb;
      opacity: 0.85;
      margin-bottom: 14px;
    }

    .winner-buttons {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    #closeWinnerBtn {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #f9fafb;
      padding-inline: 16px;
      box-shadow: 0 10px 24px rgba(22, 163, 74, 0.6);
    }

    #replayBtn {
      background: rgba(15, 23, 42, 0.94);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
      padding-inline: 16px;
    }

    .winner-confetti {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(circle at 20% 20%, rgba(248, 250, 252, 0.9) 0, transparent 60%),
        radial-gradient(circle at 80% 10%, rgba(251, 191, 36, 0.7) 0, transparent 55%),
        radial-gradient(circle at 5% 80%, rgba(59, 130, 246, 0.55) 0, transparent 60%),
        radial-gradient(circle at 90% 85%, rgba(236, 72, 153, 0.6) 0, transparent 60%);
      mix-blend-mode: screen;
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <div class="accent">Random Draw</div>
      <h1>ë§ ê²½ì£¼ ì¶”ì²¨ê¸°<span class="emoji">ğŸ</span></h1>
    </div>

    <div class="control-panel">
      <div>
        <div class="field-label">
          <span>ì°¸ê°€ì ì´ë¦„ ëª©ë¡</span>
          <span>í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥</span>
        </div>
        <textarea
          id="namesInput"
          placeholder="ì˜ˆì‹œ)&#10;í™ê¸¸ë™&#10;ì´ì˜í¬&#10;ê¹€ì² ìˆ˜&#10;ì˜¨ëˆ„ë¦¬ì²­ë…„ 1&#10;ì˜¨ëˆ„ë¦¬ì²­ë…„ 2"
        ></textarea>
        <div class="hint">â€» ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•´ì•¼ ì¶”ì²¨ì´ ì‹œì‘ë©ë‹ˆë‹¤.</div>
      </div>

      <div class="right-panel-inner">
        <div>
          <h2>ğŸ¬ ì§„í–‰ ë°©ë²•</h2>
          <ul>
            <li>ì´ë¦„ì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥í•©ë‹ˆë‹¤.</li>
            <li><strong>ë ˆì´ìŠ¤ ì‹œì‘</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë§ë“¤ì´ ì¶œë°œí•©ë‹ˆë‹¤.</li>
            <li>ì¤‘ê°„ì— ëœë¤ ìŠ¤í¼íŠ¸ & ì†ë„ ë³€í™”ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤.</li>
            <li>ê°€ì¥ ë¨¼ì € ê²°ìŠ¹ì„ ì„ í†µê³¼í•œ ë§ì´ <strong>ë‹¹ì²¨ì</strong>ì…ë‹ˆë‹¤.</li>
          </ul>
        </div>
        <div class="btn-row">
          <button id="startBtn">
            <span>ë ˆì´ìŠ¤ ì‹œì‘!</span> <span>ğŸ</span>
          </button>
          <button id="resetBtnSmall">
            ì´ˆê¸°í™”
          </button>
        </div>
      </div>
    </div>

    <div class="race-wrapper">
      <div class="race-header">
        <div class="race-header-left">
          <div class="race-light" id="raceStatusLight"></div>
          <span id="raceStatusText">ëŒ€ê¸° ì¤‘â€¦ ì°¸ê°€ìë¥¼ ì…ë ¥í•˜ê³  ë ˆì´ìŠ¤ë¥¼ ì‹œì‘í•´ ì£¼ì„¸ìš”.</span>
        </div>
        <div class="race-header-right">
          ê²°ìŠ¹ì„  ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë¨¼ì € ë„ì°©í•˜ëŠ” ë§ì´ ìš°ìŠ¹í•©ë‹ˆë‹¤.
        </div>
      </div>

      <div class="race-area" id="raceArea">
        <div class="finish-line"></div>
        <div class="finish-label">FINISH</div>
        <div class="tracks" id="tracks"></div>
      </div>
    </div>
  </div>

  <div class="winner-overlay hidden" id="winnerOverlay">
    <div class="winner-card">
      <div class="winner-confetti"></div>
      <div class="winner-icon">ğŸ†</div>
      <div class="winner-title">Winner</div>
      <div class="winner-name" id="winnerName">ì´ë¦„</div>
      <div class="winner-sub">ì¶•í•˜í•©ë‹ˆë‹¤! ì´ë²ˆ ë ˆì´ìŠ¤ì˜ ìµœì¢… ë‹¹ì²¨ìì…ë‹ˆë‹¤.</div>
      <div class="winner-buttons">
        <button id="closeWinnerBtn">ë‹«ê¸°</button>
        <button id="replayBtn">ë‹¤ì‹œ ì¶”ì²¨</button>
      </div>
    </div>
  </div>

  <script>
    const namesInput = document.getElementById("namesInput");
    const startBtn = document.getElementById("startBtn");
    const resetBtnSmall = document.getElementById("resetBtnSmall");
    const raceArea = document.getElementById("raceArea");
    const tracksEl = document.getElementById("tracks");
    const raceStatusLight = document.getElementById("raceStatusLight");
    const raceStatusText = document.getElementById("raceStatusText");

    const winnerOverlay = document.getElementById("winnerOverlay");
    const winnerNameEl = document.getElementById("winnerName");
    const closeWinnerBtn = document.getElementById("closeWinnerBtn");
    const replayBtn = document.getElementById("replayBtn");

    let horses = [];
    let raceRunning = false;
    let animationFrameId = null;

    function parseNames() {
      const raw = namesInput.value.trim();
      if (!raw) return [];
      return raw
        .split("\n")
        .map((s) => s.trim())
        .filter((s) => s.length > 0);
    }

    function resetRaceVisualOnly() {
      cancelAnimationFrame(animationFrameId);
      animationFrameId = null;
      horses = [];
      tracksEl.innerHTML = "";
      raceRunning = false;
      raceStatusLight.style.background = "#22c55e";
      raceStatusLight.style.boxShadow = "0 0 10px #22c55e";
      raceStatusText.textContent =
        "ëŒ€ê¸° ì¤‘â€¦ ì°¸ê°€ìë¥¼ ì…ë ¥í•˜ê³  ë ˆì´ìŠ¤ë¥¼ ì‹œì‘í•´ ì£¼ì„¸ìš”.";
    }

    function fullReset() {
      resetRaceVisualOnly();
      namesInput.value = "";
    }

    function setupTracks(names) {
      tracksEl.innerHTML = "";
      horses = [];

      names.forEach((name, idx) => {
        const row = document.createElement("div");
        row.className = "track-row";

        const laneLabel = document.createElement("div");
        laneLabel.className = "lane-label";
        laneLabel.textContent = idx + 1;

        const horse = document.createElement("div");
        horse.className = "horse";

        const emojiSpan = document.createElement("span");
        emojiSpan.className = "horse-emoji";
        emojiSpan.textContent = "ğŸ";

        const nameSpan = document.createElement("span");
        nameSpan.className = "horse-name";
        nameSpan.textContent = name;

        horse.appendChild(emojiSpan);
        horse.appendChild(nameSpan);

        row.appendChild(laneLabel);
        row.appendChild(horse);
        tracksEl.appendChild(row);

        horses.push({
          el: horse,
          rowEl: row,
          name,
          x: 0,
          baseSpeed: 70 + Math.random() * 30, // ê¸°ë³¸ ì†ë„ (px/sec)
          burstCooldown: 800 + Math.random() * 1500,
        });
      });
    }

    function startRace() {
      const names = parseNames();
      if (names.length < 2) {
        alert("ìµœì†Œ 2ëª… ì´ìƒ ì…ë ¥í•´ì•¼ ë ˆì´ìŠ¤ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      winnerOverlay.classList.add("hidden");
      resetRaceVisualOnly();
      setupTracks(names);

      namesInput.disabled = true;
      startBtn.disabled = true;
      resetBtnSmall.disabled = true;

      raceRunning = true;
      raceStatusLight.style.background = "#facc15";
      raceStatusLight.style.boxShadow = "0 0 10px #facc15";
      raceStatusText.textContent = "ë ˆì´ìŠ¤ ì§„í–‰ ì¤‘â€¦ ëˆ„ê°€ 1ë“±ìœ¼ë¡œ ë“¤ì–´ì˜¬ê¹Œìš”?";

      let lastTime = null;
      const finishX = raceArea.clientWidth - 210; // ê²°ìŠ¹ì„ ê¹Œì§€ì˜ ëŒ€ëµì  ê±°ë¦¬

      function step(timestamp) {
        if (!raceRunning) return;

        if (!lastTime) lastTime = timestamp;
        const delta = timestamp - lastTime;
        lastTime = timestamp;

        let winner = null;

        horses.forEach((h) => {
          // ì¿¨ë‹¤ìš´ ê°ì†Œ
          h.burstCooldown -= delta;

          // ê¸°ë³¸ ì†ë„ + ì•½ê°„ì˜ ëœë¤ í”ë“¤ë¦¼
          let speed = h.baseSpeed * (0.85 + Math.random() * 0.3);

          // ë²„ìŠ¤íŠ¸ (ê°„í—ì ìœ¼ë¡œ ì—„ì²­ ë¹ ë¥´ê²Œ ì§ˆì£¼)
          if (h.burstCooldown <= 0) {
            speed *= 2 + Math.random() * 1.2;
            // ë²„ìŠ¤íŠ¸ í›„ ì¿¨ë‹¤ìš´ ë¦¬ì…‹
            if (Math.random() < 0.06) {
              h.burstCooldown = 1000 + Math.random() * 2500;
            }
          }

          // ì´ë™ (px = ì†ë„ * ì´ˆ)
          h.x += (speed * delta) / 1000;

          // ìœ„ì¹˜ ë°˜ì˜
          h.el.style.transform = `translate(${h.x}px, -50%)`;

          if (!winner && h.x >= finishX) {
            winner = h;
          }
        });

        if (winner) {
          endRace(winner);
          return;
        }

        animationFrameId = requestAnimationFrame(step);
      }

      animationFrameId = requestAnimationFrame(step);
    }

    function endRace(winnerHorse) {
      raceRunning = false;
      cancelAnimationFrame(animationFrameId);

      // ìŠ¹ì íŠ¸ë™ì— í•˜ì´ë¼ì´íŠ¸
      horses.forEach((h) => {
        h.rowEl.classList.remove("winner-track");
      });
      winnerHorse.rowEl.classList.add("winner-track");

      raceStatusLight.style.background = "#22c55e";
      raceStatusLight.style.boxShadow = "0 0 12px #22c55e";
      raceStatusText.textContent = `ìš°ìŠ¹: ${winnerHorse.name}`;

      winnerNameEl.textContent = winnerHorse.name;
      winnerOverlay.classList.remove("hidden");

      // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
      namesInput.disabled = false;
      startBtn.disabled = false;
      resetBtnSmall.disabled = false;
    }

    startBtn.addEventListener("click", startRace);
    resetBtnSmall.addEventListener("click", fullReset);

    closeWinnerBtn.addEventListener("click", () => {
      winnerOverlay.classList.add("hidden");
    });

    replayBtn.addEventListener("click", () => {
      winnerOverlay.classList.add("hidden");
      startRace();
    });

    // Ctrl+Enter ë¡œ ë°”ë¡œ ì‹œì‘
    namesInput.addEventListener("keydown", (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
        e.preventDefault();
        if (!startBtn.disabled) startBtn.click();
      }
    });
  </script>
</body>
</html>
