<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì˜¨ëˆ„ë¦¬ ëŒ€í•™ì²­ë…„ ì „ì„êµì—­ì ê°„ì‚¬ ë¦¬íŠ¸ë¦¿ ë§ˆë¼í†¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Pretendard", system-ui, sans-serif;
}
body {
  min-height: 100vh;
  background: radial-gradient(circle at top, #1f2933, #020617 60%);
  color: #f9fafb;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 24px;
}
.container {
  width: 100%;
  max-width: 1200px;
  background: rgba(15, 23, 42, 0.92);
  border-radius: 20px;
  padding: 24px 24px 28px;
  box-shadow: 0 20px 45px rgba(0, 0, 0, 0.55);
  border: 1px solid rgba(148, 163, 184, 0.25);
}
.title {
  text-align: center;
  margin-bottom: 24px;
}
.title h1 {
  font-size: 1.8rem;
  font-weight: 800;
  margin-bottom: 6px;
  line-height: 1.3;
}
.title .accent {
  font-size: 0.9rem;
  color: #38bdf8;
  letter-spacing: 0.16em;
  text-transform: uppercase;
}

/* ê³ ì • ëŸ¬ë„ˆ ì„¤ì • ì˜ì—­ */
.fixed-runners {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}
@media (max-width: 800px) {
  .fixed-runners { grid-template-columns: 1fr 1fr; }
}
.runner-card {
  background: rgba(30, 41, 59, 0.6);
  border: 1px solid rgba(148, 163, 184, 0.2);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}
.runner-name-badge {
  font-size: 1.1rem;
  font-weight: 700;
  color: #fff;
  background: #0ea5e9;
  padding: 4px 12px;
  border-radius: 999px;
  margin-bottom: 12px;
  box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
}
.file-label {
  font-size: 0.8rem;
  color: #94a3b8;
  margin-bottom: 4px;
  cursor: pointer;
}
.file-input {
  width: 100%;
  font-size: 0.75rem;
  color: #cbd5e1;
}

/* ì˜µì…˜ ë° ë²„íŠ¼ */
.control-area {
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: center;
  margin-bottom: 20px;
}
.mode-options {
  display: flex;
  gap: 12px;
}
.mode-pill {
  border-radius: 999px;
  border: 1px solid rgba(148, 163, 184, 0.5);
  padding: 6px 16px;
  font-size: 0.9rem;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(15, 23, 42, 0.6);
  cursor: pointer;
}
#prizeWrapper {
  width: 100%;
  max-width: 600px;
  text-align: center;
}
#prizeInput {
  width: 100%;
  height: 100px; /* ë†’ì´ ì•½ê°„ ì¦ê°€ */
  background: rgba(15, 23, 42, 0.8);
  border: 1px solid rgba(148, 163, 184, 0.4);
  border-radius: 8px;
  padding: 8px;
  color: #fff;
  resize: vertical;
  line-height: 1.5;
}

.btn-row {
  display: flex;
  gap: 16px;
}
button {
  border: none;
  cursor: pointer;
  border-radius: 999px;
  padding: 14px 32px;
  font-size: 1.1rem;
  font-weight: 800;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.2s;
}
#startBtn {
  background: linear-gradient(135deg, #f97316, #ec4899);
  color: #fff;
  box-shadow: 0 8px 25px rgba(249, 115, 22, 0.5);
}
#startBtn:hover { transform: scale(1.05); }
#startBtn:disabled { filter: grayscale(1); cursor: not-allowed; transform: none; }
#resetBtn {
  background: #334155;
  color: #e2e8f0;
}

/* ë ˆì´ìŠ¤ ì˜ì—­ */
.race-wrapper {
  margin-top: 10px;
  background: rgba(15, 23, 42, 0.96);
  border-radius: 16px;
  padding: 14px;
  border: 1px solid rgba(56, 189, 248, 0.2);
  position: relative;
}
.race-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  font-size: 0.9rem;
  color: #9ca3af;
}
.race-area {
  position: relative;
  margin-top: 6px;
  padding: 20px 0; /* ìƒí•˜ ì—¬ë°± */
  border-radius: 18px;
  background: linear-gradient(#064e3b, #065f46); /* ì”ë””ìƒ‰ */
  border: 4px solid #0f172a;
  overflow: hidden;
  height: 480px; /* íŠ¸ë™ ë†’ì´ */
}
/* íŠ¸ë™ ë¼ì¸ */
.race-area::before {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(to bottom, transparent, transparent 118px, rgba(255,255,255,0.1) 118px, rgba(255,255,255,0.1) 120px);
  pointer-events: none;
}

.finish-line {
  position: absolute;
  top: 0; bottom: 0;
  right: 120px;
  width: 24px;
  background-image: linear-gradient(45deg, #fff 25%, #000 25%, #000 50%, #fff 50%, #fff 75%, #000 75%, #000);
  background-size: 24px 24px;
  z-index: 1;
}
.finish-label {
  position: absolute;
  top: 10px; right: 20px;
  color: #fbbf24;
  font-weight: 900;
  font-size: 1.5rem;
  transform: rotate(90deg);
  transform-origin: right top;
}

.tracks {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: space-evenly;
}

/* ë§(ëŸ¬ë„ˆ) ìŠ¤íƒ€ì¼ */
.horse {
  position: absolute;
  left: 20px; /* ì¶œë°œì„  */
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 10;
  transition: transform 0.05s linear;
  will-change: transform;
}
.runner-img {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #f8fafc;
  box-shadow: 0 4px 15px rgba(0,0,0,0.7);
  background: #1e293b;
}
.horse-emoji {
  font-size: 4rem;
  line-height: 1;
  filter: drop-shadow(0 4px 4px rgba(0,0,0,0.5));
}

/* ìƒíƒœ ì´í™íŠ¸ */
.horse.boosting .runner-img { border-color: #facc15; box-shadow: 0 0 25px #facc15; }
.horse.boosting::before {
  content: "ğŸ”¥"; position: absolute; left: -40px; top: 50%; transform: translateY(-50%); font-size: 2.5rem;
  animation: bounce 0.3s infinite alternate;
}
.horse.injured { filter: grayscale(1); opacity: 0.7; }
.horse.injured::after {
  content: "ğŸ©¹"; position: absolute; top: -30px; left: 20px; font-size: 2rem;
}
.horse.slipping { opacity: 0.8; }
.horse.slipping::after {
  content: "ğŸŒ"; position: absolute; top: -30px; left: 20px; font-size: 2rem; animation: spin 0.5s infinite;
}
@keyframes bounce { to { transform: translateY(-55%); } }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* ê²°ê³¼ì°½ */
.winner-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex; align-items: center; justify-content: center;
  z-index: 100;
  backdrop-filter: blur(8px);
}
.hidden { display: none !important; }

.winner-card {
  background: #1e293b;
  border: 2px solid #f97316;
  border-radius: 20px;
  padding: 30px;
  text-align: center;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 0 60px rgba(249, 115, 22, 0.4);
}
.winner-photo img {
  width: 140px; height: 140px;
  border-radius: 50%;
  border: 5px solid #fbbf24;
  margin: 10px 0;
  object-fit: cover;
}
.winner-name { font-size: 2rem; font-weight: bold; color: #fff; margin: 10px 0; }
.rank-list { text-align: left; background: #0f172a; padding: 12px; border-radius: 12px; margin-top: 16px; }
.rank-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #334155; }
.rank-row:last-child { border-bottom: none; }
.rank-left { display: flex; align-items: center; gap: 10px; }
.rank-badge { color: #fbbf24; font-weight: bold; width: 40px; }
.rank-txt { font-weight: 600; color: #e2e8f0; }
.rank-prize { font-size: 0.9rem; color: #fcd34d; text-align: right; width: 50%; }

</style>
</head>
<body>

<div id="player" style="display:none;"></div>

<div class="container">
  <div class="title">
    <div class="accent">Retreat Event</div>
    <h1>ì „ì„êµì—­ì ê°„ì‚¬ ë¦¬íŠ¸ë¦¿ ë§ˆë¼í†¤ ğŸƒ</h1>
  </div>

  <div class="fixed-runners">
    <div class="runner-card">
      <div class="runner-name-badge">1. ì˜ˆë°°ê¸°íš</div>
      <label class="file-label">ğŸ“¸ ì‚¬ì§„ ì„ íƒ:</label>
      <input type="file" id="file0" class="file-input" accept="image/*">
    </div>
    <div class="runner-card">
      <div class="runner-name-badge">2. ì„ êµ</div>
      <label class="file-label">ğŸ“¸ ì‚¬ì§„ ì„ íƒ:</label>
      <input type="file" id="file1" class="file-input" accept="image/*">
    </div>
    <div class="runner-card">
      <div class="runner-name-badge">3. ì–‘ìœ¡</div>
      <label class="file-label">ğŸ“¸ ì‚¬ì§„ ì„ íƒ:</label>
      <input type="file" id="file2" class="file-input" accept="image/*">
    </div>
    <div class="runner-card">
      <div class="runner-name-badge">4. ì‚¬ì—­ìº í¼ìŠ¤</div>
      <label class="file-label">ğŸ“¸ ì‚¬ì§„ ì„ íƒ:</label>
      <input type="file" id="file3" class="file-input" accept="image/*">
    </div>
  </div>

  <div class="control-area">
    <div class="mode-options">
      <label class="mode-pill">
        <input type="radio" name="mode" value="rank" checked /> ìˆœìœ„ë§Œ ë³´ê¸°
      </label>
      <label class="mode-pill">
        <input type="radio" name="mode" value="match" /> ê²°ìŠ¹ì„  ë§¤ì¹­
      </label>
    </div>
    <div id="prizeWrapper" class="hidden">
      <textarea id="prizeInput" placeholder="ê²°ìŠ¹ì„  í•­ëª© ì…ë ¥"></textarea>
    </div>
    <div class="btn-row">
      <button id="startBtn">ë ˆì´ìŠ¤ ì‹œì‘! ğŸ</button>
      <button id="resetBtn">ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="race-wrapper">
    <div class="race-header">
      <span id="raceStatus">ëŒ€ê¸° ì¤‘...</span>
      <span>ê²°ìŠ¹ì„  í†µê³¼ ìˆœì„œëŒ€ë¡œ ê²°ì •</span>
    </div>
    <div class="race-area" id="raceArea">
      <div class="finish-line"></div>
      <div class="finish-label">FINISH</div>
      <div class="tracks" id="tracks"></div>
    </div>
  </div>
</div>

<div class="winner-overlay hidden" id="winnerOverlay">
  <div class="winner-card">
    <div>ğŸ† Result</div>
    <div id="winnerPhoto" class="winner-photo"></div>
    <div class="winner-name" id="winnerName"></div>
    <div id="rankList" class="rank-list"></div>
    <div style="margin-top:20px; display:flex; justify-content:center; gap:10px;">
      <button id="closeBtn" style="padding:10px 20px; font-size:0.9rem; background:#475569;">ë‹«ê¸°</button>
      <button id="replayBtn" style="padding:10px 20px; font-size:0.9rem; background:#0ea5e9;">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
  </div>
</div>

<script>
// --- ì „ì—­ ì„¤ì • ---
const FIXED_NAMES = ["ì˜ˆë°°ê¸°íš", "ì„ êµ", "ì–‘ìœ¡", "ì‚¬ì—­ìº í¼ìŠ¤"];
let horses = [];
let raceRunning = false;
let animationFrameId = null;
let finishedOrder = [];
let imgBlobs = [];
let youtubePlayer = null;

// --- ìœ íŠœë¸Œ BGM ì„¤ì • ---
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
const firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

function onYouTubeIframeAPIReady() {
  youtubePlayer = new YT.Player('player', {
    height: '0', width: '0',
    videoId: 'ZzHYbM0l4ec', // ë¶ˆì˜ ì „ì°¨
  });
}
function playMusic() { if(youtubePlayer?.playVideo) { youtubePlayer.seekTo(0); youtubePlayer.playVideo(); } }
function stopMusic() { if(youtubePlayer?.stopVideo) youtubePlayer.stopVideo(); }

// --- DOM ---
const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const tracksEl = document.getElementById("tracks");
const winnerOverlay = document.getElementById("winnerOverlay");
const prizeWrapper = document.getElementById("prizeWrapper");
const prizeInput = document.getElementById("prizeInput");
const modeRadios = document.querySelectorAll('input[name="mode"]');

// ëª¨ë“œ í† ê¸€ (ìë™ ì…ë ¥ ê¸°ëŠ¥ ì¶”ê°€)
modeRadios.forEach(r => r.addEventListener('change', () => {
  const isMatch = r.value === 'match';
  prizeWrapper.classList.toggle('hidden', !isMatch);
  if(isMatch) {
    // ìë™ ì…ë ¥
    prizeInput.value = "ìµœì„±ë¯¼\nì´ì„œì§„\nì‹ ì •ê¸ˆ\nê°•ìœ ì„ \nì„œí˜œë¦¼";
  }
}));

// ì¤„ë°”ê¿ˆ íŒŒì‹±
function parseLines(v) { return v.trim().split('\n').map(s=>s.trim()).filter(s=>s.length>0); }

// --- ì´ˆê¸°í™” ë° ë§ ì„¸íŒ… ---
function setupRace() {
  imgBlobs.forEach(url => URL.revokeObjectURL(url));
  imgBlobs = [];
  horses = [];
  finishedOrder = [];
  tracksEl.innerHTML = "";
  
  FIXED_NAMES.forEach((name, idx) => {
    const fileInput = document.getElementById(`file${idx}`);
    let imgUrl = null;
    if(fileInput.files && fileInput.files[0]) {
      imgUrl = URL.createObjectURL(fileInput.files[0]);
      imgBlobs.push(imgUrl);
    }

    const horseEl = document.createElement("div");
    horseEl.className = "horse";
    const topPos = 15 + (idx * 22); 
    horseEl.style.top = topPos + "%"; 

    if(imgUrl) {
      const img = document.createElement("img");
      img.src = imgUrl;
      img.className = "runner-img";
      horseEl.appendChild(img);
    } else {
      const emoji = document.createElement("div");
      emoji.className = "horse-emoji";
      emoji.textContent = "ğŸƒ";
      horseEl.appendChild(emoji);
    }

    tracksEl.appendChild(horseEl);

    horses.push({
      id: idx,
      name: name,
      el: horseEl,
      imgUrl: imgUrl,
      x: 0,
      finished: false,
      // ëŠë¦° ì†ë„ (ì¥ê±°ë¦¬ ë ˆì´ìŠ¤)
      baseSpeed: 15 + Math.random() * 5, 
      
      // ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
      nextBoost: 0.2 + Math.random() * 0.6,
      boostDuration: 0,
      isBoosting: false,
      
      nextInjury: 0.3 + Math.random() * 0.4,
      injuryDuration: 0,
      isInjured: false,

      nextBanana: 0.4 + Math.random() * 0.4,
      bananaUsed: false,
      
      isSlipping: false,
      slipDuration: 0,

      // ë§‰íŒ ë’¤ì§‘ê¸°
      finalDrama: 0.85 + Math.random() * 0.05, 
      finalAction: Math.random() > 0.5 ? 'boost' : 'injury', 
      dramaUsed: false
    });
  });
}

// --- ë£¨í”„ ---
let lastTime = 0;
function getFinishX() { return document.getElementById("raceArea").clientWidth - 160; }

function loop(timestamp) {
  if(!raceRunning) return;
  if(!lastTime) lastTime = timestamp;
  const dt = timestamp - lastTime;
  lastTime = timestamp;

  const finishX = getFinishX();
  const xs = horses.map(h => h.x);
  const leaderX = Math.max(...xs);
  const lastX = Math.min(...xs);
  const dist = leaderX - lastX || 1;

  horses.forEach(h => {
    if(h.finished) return;

    const progress = h.x / finishX;
    let currentSpeed = h.baseSpeed; 

    // ê³ ë¬´ì¤„ íš¨ê³¼
    const rankFactor = (leaderX - h.x) / dist; 
    currentSpeed += (rankFactor * 10); 

    // ìƒíƒœ ì²˜ë¦¬
    if(h.isSlipping) {
      currentSpeed = -10; 
      h.slipDuration -= dt;
      if(h.slipDuration <= 0) { h.isSlipping = false; h.el.classList.remove("slipping"); }
    }
    else if(h.isInjured) {
      currentSpeed *= 0.2; 
      h.injuryDuration -= dt;
      if(h.injuryDuration <= 0) { h.isInjured = false; h.el.classList.remove("injured"); }
    }
    else if(h.isBoosting) {
      currentSpeed *= 4.0; 
      h.boostDuration -= dt;
      if(h.boostDuration <= 0) { h.isBoosting = false; h.el.classList.remove("boosting"); }
    }
    else {
      // ì¼ë°˜ ì£¼í–‰ ì´ë²¤íŠ¸
      if(!h.bananaUsed && progress > h.nextBanana) {
        h.bananaUsed = true;
        const targets = horses.filter(t => !t.finished && t.x > h.x);
        if(targets.length > 0) {
          const victim = targets[Math.floor(Math.random()*targets.length)];
          victim.isSlipping = true;
          victim.slipDuration = 2000; 
          victim.isBoosting = false; victim.el.classList.remove("boosting");
          victim.el.classList.add("slipping");
        }
      }

      if(progress > h.nextBoost && progress < h.nextBoost + 0.1) {
        h.nextBoost = 2; 
        h.isBoosting = true;
        h.boostDuration = 3000; 
        h.el.classList.add("boosting");
      }

      if(progress > h.nextInjury && progress < h.nextInjury + 0.1 && Math.random() < 0.02) {
        h.nextInjury = 2;
        h.isInjured = true;
        h.injuryDuration = 2500; 
        h.el.classList.add("injured");
      }

      if(!h.dramaUsed && progress > h.finalDrama) {
        h.dramaUsed = true;
        if(h.finalAction === 'boost') {
          h.isBoosting = true;
          h.boostDuration = 5000; 
          h.el.classList.add("boosting");
        } else {
          h.isInjured = true;
          h.injuryDuration = 3000;
          h.el.classList.add("injured");
        }
      }
    }

    // ì†ë„ ê³„ìˆ˜ 1.2 (ì•½ 30ì´ˆ ë ˆì´ìŠ¤)
    const move = (currentSpeed * dt) / 1000 * 1.2; 
    h.x += move;

    if(h.x >= finishX) {
      h.x = finishX;
      h.finished = true;
      h.el.classList.remove("boosting", "injured", "slipping");
      finishedOrder.push(h);
      h.x += (FIXED_NAMES.length - finishedOrder.length) * 15;
    }

    h.el.style.transform = `translateX(${h.x}px)`;
  });

  if(finishedOrder.length === horses.length) {
    raceRunning = false;
    stopMusic();
    setTimeout(showResult, 1500);
  } else {
    animationFrameId = requestAnimationFrame(loop);
  }
}

function startRace() {
  const mode = document.querySelector('input[name="mode"]:checked').value;
  // ì¤‘ë³µ ì—†ëŠ” ë§¤ì¹­ì„ ìœ„í•´ ìµœì†Œ 5ê°œ í™•ì¸
  const lines = parseLines(prizeInput.value);
  if(mode === 'match' && lines.length < 5) {
    alert("ì¤‘ë³µ ì—†ëŠ” ë§¤ì¹­ì„ ìœ„í•´ í•­ëª©ì„ 5ê°œ ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  startBtn.disabled = true;
  resetBtn.disabled = true;
  document.querySelectorAll('input').forEach(i => i.disabled = true);
  document.getElementById("winnerOverlay").classList.add("hidden");

  playMusic();
  setupRace();
  
  raceRunning = true;
  lastTime = null;
  document.getElementById("raceStatus").textContent = "ğŸ”¥ ë ˆì´ìŠ¤ ì§„í–‰ ì¤‘! (ì•½ 30ì´ˆ ì†Œìš”)";
  
  requestAnimationFrame(loop);
}

function showResult() {
  const winner = finishedOrder[0];
  const mode = document.querySelector('input[name="mode"]:checked').value;
  let prizes = [];
  
  if(mode === 'match') {
    const raw = parseLines(prizeInput.value);
    
    // ì¤‘ë³µ ì œê±° ë¡œì§:
    // ì›ë³¸ ë°°ì—´(raw)ì„ ë³µì œí•˜ì—¬ ì„ì€ ë’¤(shuffle), í•˜ë‚˜ì”© êº¼ë‚´ì”€(pop or shift)
    // ì´ë ‡ê²Œ í•˜ë©´ ì¤‘ë³µ ë‹¹ì²¨ì´ ë°œìƒí•˜ì§€ ì•ŠìŒ.
    
    let pool = [...raw];
    // Fisher-Yates Shuffle
    for (let i = pool.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [pool[i], pool[j]] = [pool[j], pool[i]];
    }
    prizes = pool;
  }

  document.getElementById("winnerName").textContent = `1ë“±: ${winner.name}`;
  const ph = document.getElementById("winnerPhoto");
  ph.innerHTML = "";
  if(winner.imgUrl) {
    const img = document.createElement("img");
    img.src = winner.imgUrl;
    ph.appendChild(img);
  } else {
    ph.innerHTML = "<span style='font-size:4rem'>ğŸ‰</span>";
  }

  const list = document.getElementById("rankList");
  list.innerHTML = "";
  
  // prizes ë°°ì—´ì—ì„œ ì•ì—ì„œë¶€í„° í•˜ë‚˜ì”© êº¼ë‚´ì”€
  let pIndex = 0;
  
  finishedOrder.forEach((h, idx) => {
    const row = document.createElement("div");
    row.className = "rank-row";
    
    let myPrize = "";
    if(mode === 'match') {
      // ì²« ë²ˆì§¸ í•­ëª© í• ë‹¹
      let p1 = prizes[pIndex++] || "(ì—†ìŒ)";
      myPrize = p1;
      
      // ì‚¬ì—­ìº í¼ìŠ¤: íˆë“ ìœ¼ë¡œ í•˜ë‚˜ ë” ê°€ì ¸ê°
      if(h.name === "ì‚¬ì—­ìº í¼ìŠ¤") {
        let p2 = prizes[pIndex++] || "(ì—†ìŒ)";
        myPrize = `1ï¸âƒ£${p1}, 2ï¸âƒ£${p2}`;
      }
    }

    row.innerHTML = `
      <div class="rank-left">
        <span class="rank-badge">${idx+1}ë“±</span>
        <span class="rank-txt">${h.name}</span>
      </div>
      <div class="rank-prize">${myPrize}</div>
    `;
    list.appendChild(row);
  });

  winnerOverlay.classList.remove("hidden");
  
  startBtn.disabled = false;
  resetBtn.disabled = false;
  document.querySelectorAll('input').forEach(i => i.disabled = false);
}

// ì´ë²¤íŠ¸
startBtn.addEventListener("click", startRace);
resetBtn.addEventListener("click", () => {
  stopMusic();
  raceRunning = false;
  cancelAnimationFrame(animationFrameId);
  setupRace();
  document.getElementById("raceStatus").textContent = "ëŒ€ê¸° ì¤‘...";
});
document.getElementById("closeBtn").addEventListener("click", () => winnerOverlay.classList.add("hidden"));
document.getElementById("replayBtn").addEventListener("click", () => {
  winnerOverlay.classList.add("hidden");
  startRace();
});

setupRace();

</script>
</body>
</html>
